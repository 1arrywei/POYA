@model POYA.Areas.XAd.Models.XAdCustomer

@{
    ViewData["Title"] = Localizer["Become our advertiser"];
    Layout = "~/Views/Shared/_Layout.cshtml";
    var RandomFormId = Guid.NewGuid();
}


<h4>@ViewData["Title"]</h4>

<hr />
<div class="row">
    <div class="col-12">
        <form asp-action="Create" id="@RandomFormId" enctype="multipart/form-data">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>

            <div class="form-group col col-5">
                <label asp-for="StoreIconFile" class="control-label"></label><sup class="Upload-Tip">@Localizer["Click image to select store icon"]</sup>
                <div class="col col-12 text-center">
                    <span class="Default-Icon-Tip">
                        @(Localizer["The default image is disabled"])
                    </span>
                    <img id="_StoreIconFile_Img_" src='@(Url.Action("GetLAppContent","Home",new {ContentNmae= "img/earticle_home_default_img.webp"}))' 
                         title='@Localizer["Click to select store icon"]' />
                </div>
                <input asp-for="StoreIconFile" hidden />
                <span asp-validation-for="Name" class="text-danger"></span>
                <span id="StoreIconFileValidation" class="text-danger"></span>
            </div>

            <div class="form-group col col-5">
                <label asp-for="Name" class="control-label"></label>
                <input asp-for="Name" class="form-control" autocomplete="off" />
                <span asp-validation-for="Name" class="text-danger"></span>
            </div>

            <div class="form-group col col-5">
                <label asp-for="Address" class="control-label"></label>
                <input asp-for="Address" class="form-control" autocomplete="off" />
                <span asp-validation-for="Address" class="text-danger"></span>
            </div>

            <div class="form-group col col-5">
                <label asp-for="Intro" class="control-label"></label>
                <textarea asp-for="Intro" class="form-control" autocomplete="off"></textarea>
                <span asp-validation-for="Intro" class="text-danger"></span>
            </div>


            <div class="form-group col col-12">
                <label asp-for="LicenseImgFiles" class="control-label"></label><sup class="Upload-Tip Image-Count-Tip">@Localizer["Image count"] => 3~5</sup>
                <div id="LicenseImgFileEle" class="row">
                </div>
                <span asp-validation-for="LicenseImgFiles" class="text-danger"></span><br />
                <a id="SelectLicenseImgFileEle" class="btn btn-outline-info">
                    @Localizer["Select license image files"] &#128449;
                </a>
                <div id="LicenseImgFilevalidation"></div>
            </div>

            <div class="form-group">
                <a id="BackEle" class="btn btn-outline-info">&laquo; @Localizer["Back"]</a>
                <a id="XAdCustomerRegisterEle" class="btn btn-outline-success">@Localizer["Register"]</a>
                <span id="Common-Tip"></span>
            </div>
        </form>
    </div>
</div>



@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script>
        var SizeOfFileHint = (xMByte) => `@(Localizer["The size of file should be not more than"]) ${xMByte}M`;
        var ClickToDelete = `@(Localizer["Click to delete"])`;
        var _RandomFormId = `@(RandomFormId)`;
        var _DefaultImageIsDisabled = `@Localizer["The default image is disabled"]`;
        var LicenseImgPrefix = "LicenseImg_";
        var LicenseImgFileInput = (id) => `<input id='${id}' type='file' name='LicenseImgFiles' form='${_RandomFormId}' class='XLicenseImgFiles' accept='image/*' hidden/>`;
        var LicenseImg = (_LicenseImgFileInputId) => `<img id='${LicenseImgPrefix + _LicenseImgFileInputId}' class='XLicenseImg col col-auto' title='${ClickToDelete}'/>`;
        $(document).ready(function () {
            setTimeout(function () {
                $(".Default-Icon-Tip").hide();
            },4000);
        });

        $(document).on(`click`, `#XAdCustomerRegisterEle`, function () {
            if ($(`#StoreIconFile`).val().length < 1) {
                $(`#Common-Tip`).html(_DefaultImageIsDisabled);
                $(`#Common-Tip`).css(`animation`, `CommonTipAnimation 0.5s 3 linear`);
                $(`#_StoreIconFile_Img_`).css(`animation`, `StoreIconFileImgAnimation 0.2s  linear infinite alternate`);
                setTimeout(function () {
                    $(`#Common-Tip`).html(_DefaultImageIsDisabled + ` &#9757;`);
                    $(`#_StoreIconFile_Img_`).css(`animation`, ``);
                }, 1500);

                setTimeout(function () {
                    $(`#Common-Tip`).html('');
                    $(`#Common-Tip,#_StoreIconFile_Img_`).css(`animation`, ``);
                }, 3000);
                return;
            }
            $(`input`).each(function (index, element) {
                if ($(element).val().length < 1) $(element).remove();
            });
            if (!IsFileCountValid()) return;
         
            $(`#${_RandomFormId}`).submit();
        });

        $(document).on("click", "#SelectLicenseImgFileEle", function () {

            if (!IsFileCountValid(true)) return;

            if ($(`#LicenseImgFileEle input:last`).val()!="") {
                var _id = NewGuid();
                $(`#LicenseImgFileEle`).append(LicenseImgFileInput(_id));
                $(`#${_id}`).click();
            } else {
                $(`#LicenseImgFileEle input:last`).click();
            }
            event.preventDefault();
        });
        $(document).on("change", ".XLicenseImgFiles", function () {
            var LicenseImgFileInputId = $(this).attr("id");
            var _File = document.getElementById(LicenseImgFileInputId).files[0];
            if (_File.size > 2048 * 1024) {
                $("#LicenseImgFilevalidation").html(SizeOfFileHint(2));

                $(`#${LicenseImgFileInputId}`).remove();

                setTimeout(function () {
                    $("#LicenseImgFilevalidation").hide();
                }, 2500);
                return;
            }
            $(`#${LicenseImgFileInputId}`).after(LicenseImg(LicenseImgFileInputId));
            var reader = new FileReader();
            reader.readAsDataURL(_File);
            reader.onload = function (e) {
                $(`#${LicenseImgPrefix + LicenseImgFileInputId}`).get(0).src = e.target.result;
            }
        });

        $(document).on('click', "#LicenseImgFileEle img", function () {
            var ImgId = $(this).attr("id");
            var InputId = ImgId.split("_")[1];
            $(`#${ImgId}`).css("animation", "LicenseImgFileEleDelete 0.45s forwards linear");
            setTimeout(function () {
                $(`#${ImgId},#${InputId}`).remove();
            },450);
        });

        $(document).on("click", "#_StoreIconFile_Img_", function () {
            $("#StoreIconFile").click();
        });

        $(document).on("change", `#StoreIconFile`, function () {

            var StoreIconFileInputId = $(this).attr("id");
            var _File_ = document.getElementById(StoreIconFileInputId).files[0];
            if (_File_.size > 2048 * 1024) {
                $("#StoreIconFileValidation").text(SizeOfFileHint(2));
                setTimeout(function () {
                    $("#StoreIconFileValidation").text("");
                }, 2500);
                return;
            }

            var _reader = new FileReader();
            _reader.readAsDataURL(_File_);
            _reader.onload = function (e) {
                $(`#_StoreIconFile_Img_`).get(0).src = e.target.result;
            }
        });

        function IsFileCountValid(IsSelectEleClick = false) {
            var _FileCount = $(`.XLicenseImg`).length;
            console.log(_FileCount);
            if (IsSelectEleClick && _FileCount < 3) return true;
            if (_FileCount >4 ||  _FileCount < 3) {
                $(`.Image-Count-Tip`).css(`animation`, `GlintBackgroundColor 0.5s 2 linear`);
                setTimeout(function () {
                    $(`.Image-Count-Tip`).css(`animation`, ``);
                }, 1000);
                return false
            }
            return true;
        }
    </script>
}



@section Styles{
    <style>
        .Default-Icon-Tip{
            position:fixed;
            z-index:999;
            font-size: 80%;
            color:honeydew;
            border: dotted;
            border-color:aliceblue;
            border-radius: 5px;
        }
        .Upload-Tip {
            font-size: 80%;
            color: blue;
            border: dotted;
            border-color: coral;
            border-radius: 5px;
        }

        #_StoreIconFile_Img_ {
            max-height: 90%;
            max-width: 100%;
            object-fit: cover;
        }

            #_StoreIconFile_Img_:hover {
                animation: StoreIconFileImgAnimation 0.2s linear forwards;
            }

        #SelectLicenseImgFileEle {
            margin-top: 8px;
            transform: scale(1.2);
        }

        .XLicenseImg {
            animation: XLicenseImgAnimation 0.2s forwards linear;
            max-width: 80%;
            max-height: 200px;
            margin-top: 8px;
        }

        @@keyframes StoreIconFileImgAnimation {
            100% {
                transform: scale(1.15);
            }
        }

        @@keyframes XLicenseImgAnimation {
            0% {
                transform: scale(0.5);
            }

            100% {
                transform: scale(1);
            }
        }

        @@keyframes LicenseImgFileEleDelete {
            0% {
                transform: scale(1);
            }

            10% {
                transform: scale(1.12);
            }

            100% {
                transform: scale(0.1);
            }
        }

        #DeleteLicenseImgFile {
            position: absolute;
            z-index: 999;
            color: red;
            transform: scale(4);
        }

        @@keyframes GlintBackgroundColor{
            0%{
                background-color:red;
                font-size:80%;
            }
            50%{
                background-color:Highlight;
                font-size:88%;
            }
            100%{
                background-color:red;
                font-size:80%;
            }
        }

        @@keyframes CommonTipAnimation {
              0%{
                color:red;
                font-size:100%;
                font-weight:100;
            }
            50%{
                color:Highlight;
                font-size:120%;
                font-weight:600;
            }
            100%{
                color:red;
                font-size:100%;
                font-weight:100;
            }
        }
    </style>
}


@*


        <h1>Create</h1>

        <h4>XAdCustomer</h4>

    <div>
        <a asp-action="Index">Back to List</a>
    </div>

*@